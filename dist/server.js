"use strict";var J=Object.create;var R=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,M=Object.prototype.hasOwnProperty;var V=(e,t,o,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of L(t))!M.call(e,a)&&a!==o&&R(e,a,{get:()=>t[a],enumerable:!(s=H(t,a))||s.enumerable});return e};var p=(e,t,o)=>(o=e!=null?J(k(e)):{},V(t||!e||!e.__esModule?R(o,"default",{value:e,enumerable:!0}):o,e));var I=p(require("express"));var _=p(require("express")),C=p(require("swagger-ui-express"));var T=require("zod-openapi");var q=p(require("express"));var m=class e extends Error{constructor(t){super(`Duplicate ID found: ${t}`),this.name="DuplicateIDError",Object.setPrototypeOf(this,e.prototype)}};var i=class extends Error{constructor(t,o){super(`${t} with ID ${o} not found`),this.name="NotFoundError"}};var j=[{id:"401bccf5-cf9e-489d-8412-446cd169a0f1",nome:"Rommel Carneiro",dataDeIncorporacao:"1992/10/04",cargo:"Investigador"},{id:"501bccf5-cf9e-489d-8412-446cd169a0f1",nome:"Ana Paula Silva",dataDeIncorporacao:"1995/05/15",cargo:"Delegado"}];function W(){return j}function D(e){let t=j.find(o=>o.id===e);if(t===void 0)throw new i("Agent",e);return t}function K(e){try{D(e.id)}catch(t){throw t instanceof i?new m(e.id):t}return j.push(e),e}function Q(e,t){return Object.assign(e,t),e}function X(e){let t=j.findIndex(o=>o.id===e);if(t===-1)throw new i("Agent",e);j.splice(t,1)}var c={findAll:W,findById:D,createAgent:K,updateAgent:Q,deleteAgent:X};var h=p(require("zod")),Y=h.default.uuidv4().meta({description:"Unique identifier for the agent",example:"123e4567-e89b-12d3-a456-426614174000"}),ee=h.default.string().min(2).max(100).meta({description:"Name of the agent",example:"John Doe"}),te=h.default.string().regex(/^\d{4}\/\d{2}\/\d{2}$/).meta({description:"Incorporation date of the agent",example:"2023/01/01"}),oe=h.default.string().min(2).max(100).meta({description:"Position of the agent",example:"Delegate"}),se=h.default.object({id:Y,nome:ee,dataDeIncorporacao:te,cargo:oe}).meta({id:"Agent",description:"Schema for an agent in the system",example:{id:"123e4567-e89b-12d3-a456-426614174000",nome:"John Doe",dataDeIncorporacao:"2023/01/01",cargo:"Sales Manager"}}),n=se;function ne(e,t){let o=c.findAll();t.json(o)}function ae(e,t){let o=e.params.id,s=c.findById(o);t.json(s)}function re(e,t){let o=n.parse(e.body),s=c.createAgent(o);t.status(201).json(s)}function ie(e,t){let o=e.params.id,s=c.findById(o),a=n.omit({id:!0}).parse(e.body),u=c.updateAgent(s,a);t.json(u)}function ce(e,t){let o=e.params.id,s=c.findById(o),a=n.omit({id:!0}).partial().parse(e.body),u=c.updateAgent(s,a);t.json(u)}function pe(e,t){let o=e.params.id;try{c.deleteAgent(o)}catch{}t.status(204).send()}var f={getAllAgents:ne,getAgentById:ae,createAgent:re,overwriteAgent:ie,updateAgent:ce,deleteAgent:pe};var w=p(require("zod"));var g=q.default.Router(),de={summary:"Get all agents",responses:{200:{description:"List of agents",content:{"application/json":{schema:w.default.array(n)}}}}};g.get("/agentes",f.getAllAgents);var me={summary:"Get an agent by ID",parameters:[{name:"id",in:"path",required:!0,schema:{type:"string",format:"uuid"}}],responses:{200:{description:"Agent found",content:{"application/json":{schema:n}}},404:{description:"Agent not found"}}};g.get("/agentes/:id",f.getAgentById);var ue={summary:"Create a new agent",requestBody:{content:{"application/json":{schema:n}}},responses:{201:{description:"Agent created",content:{"application/json":{schema:n}}}}};g.post("/agentes",f.createAgent);var fe={summary:"Overwrite an existing agent",parameters:[{name:"id",in:"path",required:!0,schema:{type:"string",format:"uuid"}}],requestBody:{content:{"application/json":{schema:n.omit({id:!0})}}},responses:{200:{description:"Agent updated",content:{"application/json":{schema:n}}}}};g.put("/agentes/:id",f.overwriteAgent);var ge={summary:"Update an existing agent",parameters:[{name:"id",in:"path",required:!0,schema:{type:"string",format:"uuid"}}],requestBody:{content:{"application/json":{schema:n.omit({id:!0}).partial()}}},responses:{200:{description:"Agent updated",content:{"application/json":{schema:n}}}}};g.patch("/agentes/:id",f.updateAgent);var le={summary:"Delete an agent",parameters:[{name:"id",in:"path",required:!0,schema:{type:"string",format:"uuid"}}],responses:{204:{description:"Agent deleted successfully"}}};g.delete("/agentes/:id",f.deleteAgent);var B={"/agentes":{get:de,post:ue},"/agentes/:id":{get:me,put:fe,patch:ge,delete:le}},Z=g;var S=p(require("express"));var b=[{id:"f5fb2ad5-22a8-4cb4-90f2-8733517a0d46",titulo:"homicidio",descricao:"Disparos foram reportados \xE0s 22:33 do dia 10/07/2007 na regi\xE3o do bairro Uni\xE3o, resultando na morte da v\xEDtima, um homem de 45 anos.",status:"aberto",agente_id:"401bccf5-cf9e-489d-8412-446cd169a0f1"},{id:"a2b3c4d5-e6f7-8a9b-0c1d-2e3f4g5h6i7j",titulo:"furto",descricao:"Relato de furto de ve\xEDculo \xE0s 14:20 do dia 12/07/2007 na regi\xE3o do bairro Centro.",status:"solucionado",agente_id:"401bccf5-cf9e-489d-8412-446cd169a0f1"}];function Ae(){return b}function v(e){let t=b.find(o=>o.id===e);if(t===void 0)throw new i("Case",e);return t}function he(e){try{v(e.id)}catch(t){throw t instanceof i?new m(e.id):t}return c.findById(e.agente_id),b.push(e),e}function ye(e,t){return t.agente_id&&c.findById(t.agente_id),Object.assign(e,t),e}function Oe(e){let t=b.findIndex(o=>o.id===e);if(t===-1)throw new i("Case",e);b.splice(t,1)}var d={findAll:Ae,findById:v,createCase:he,updateCase:ye,deleteCase:Oe};var y=p(require("zod"));var je=y.default.uuidv4().meta({description:"Unique identifier for the case",example:"123e4567-e89b-12d3-a456-426614174000"}),be=y.default.string().min(2).max(100).meta({description:"Title of the case",example:"Case Title"}),Ce=y.default.string().min(10).max(1e3).meta({description:"Description of the case",example:"Detailed description of the case"}),xe=y.default.enum(["aberto","solucionado"]).meta({description:"Status of the case",example:"aberto"}),Ie=y.default.object({id:je,titulo:be,descricao:Ce,status:xe,agente_id:n.shape.id}).meta({id:"Case",description:"Schema for a case in the system",example:{id:"123e4567-e89b-12d3-a456-426614174000",titulo:"Case Title",descricao:"Detailed description of the case",status:"aberto",agente_id:"123e4567-e89b-12d3-a456-426614174000"}}),r=Ie;function Re(e,t){let o=d.findAll();t.json(o)}function De(e,t){let o=e.params.id,s=d.findById(o);t.json(s)}function qe(e,t){let o=r.parse(e.body),s=d.createCase(o);t.status(201).json(s)}function we(e,t){let o=e.params.id,s=d.findById(o),a=r.omit({id:!0}).parse(e.body),u=d.updateCase(s,a);t.json(u)}function Be(e,t){let o=e.params.id,s=d.findById(o),a=r.omit({id:!0}).partial().parse(e.body),u=d.updateCase(s,a);t.json(u)}function Ze(e,t){let o=e.params.id;try{d.deleteCase(o)}catch{}t.status(204).send()}var l={getAllCases:Re,getCaseById:De,createCase:qe,overwriteCase:we,updateCase:Be,deleteCase:Ze};var P=p(require("zod"));var A=S.default.Router(),ve={summary:"Get all cases",responses:{200:{description:"List of cases",content:{"application/json":{schema:P.default.array(r)}}}}};A.get("/casos",l.getAllCases);var Se={summary:"Get a case by ID",parameters:[{name:"id",in:"path",required:!0,schema:{type:"string",format:"uuid"}}],responses:{200:{description:"Case found",content:{"application/json":{schema:r}}},404:{description:"Case not found"}}};A.get("/casos/:id",l.getCaseById);var Pe={summary:"Create a new case",requestBody:{content:{"application/json":{schema:r}}},responses:{201:{description:"Case created successfully",content:{"application/json":{schema:r}}}}};A.post("/casos",l.createCase);var Ee={summary:"Overwrite a case by ID",parameters:[{name:"id",in:"path",required:!0,schema:{type:"string",format:"uuid"}}],requestBody:{content:{"application/json":{schema:r.omit({id:!0})}}},responses:{200:{description:"Case updated successfully",content:{"application/json":{schema:r}}}}};A.put("/casos/:id",l.overwriteCase);var ze={summary:"Update a case by ID",parameters:[{name:"id",in:"path",required:!0,schema:{type:"string",format:"uuid"}}],requestBody:{content:{"application/json":{schema:r.omit({id:!0}).partial()}}},responses:{200:{description:"Case updated successfully",content:{"application/json":{schema:r}}}}};A.patch("/casos/:id",l.updateCase);var Te={summary:"Delete a case by ID",parameters:[{name:"id",in:"path",required:!0,schema:{type:"string",format:"uuid"}}],responses:{204:{description:"Case deleted successfully"}}};A.delete("/casos/:id",l.deleteCase);var E={"/casos":{get:ve,post:Pe},"/casos/:id":{get:Se,put:Ee,patch:ze,delete:Te}},z=A;var U=(0,T.createDocument)({openapi:"3.1.1",info:{title:"WT Journey API - Etapa 2",version:"1.0.0"},paths:{...B,...E}});var x=_.default.Router();x.use("/docs",C.default.serve);x.get("/docs",C.default.setup(U));var $=x;var F=require("zod");function G(e,t,o,s){switch(console.error(e.stack),!0){case e instanceof F.ZodError:return o.status(400).json({message:"Validation error",errors:e.issues});case e instanceof m:return o.status(409).json({message:e.message});case e instanceof i:return o.status(404).json({message:e.message});default:return o.status(500).json({message:"Internal server error"})}}var O=(0,I.default)(),N=process.env.PORT||3e3;O.use(I.default.json());O.use($);O.use(Z);O.use(z);O.use(G);O.listen(N,()=>{console.log(`Server is running on port ${N}`)});
